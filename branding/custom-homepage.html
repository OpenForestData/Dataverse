<div class="row-search">
    <div class="search-main">
        <div class="title">
            <p class="search-text">Szukaj po informacjach zawartych w katalogach, plikach jak i metadanych.</p>
        </div>
        <div class="input-search-container">
            <input id="inputDataverseSearch" class="form-control input-search" type="text" placeholder="Szukaj" onkeydown="if (event.keyCode == 13) document.getElementById('btnDataverseSearch').click();">
            <button id="btnDataverseSearch" style="display: none;" type="button" onclick="window.location = '/dataverse/root?q=' + document.getElementById('inputDataverseSearch').value;return false;"></button>
            <span class="search-icon">
                <img src="logos/navbar/search.svg" />
            </span>
            <!-- <span class="input-group-btn">
                <button id="btnDataverseSearch" class="btn btn-default" type="button"
                    onclick="window.location = '/dataverse/root?q=' + document.getElementById('inputDataverseSearch').value;return false;"><span
                        class="glyphicon glyphicon-search"></span> Szukaj</button>
            </span> -->
        </div>
        <!-- <div class="col-md-5 col-sm-6 col-xs-11">
                <div class="search-widget input-group">
                    <input id="inputDataverseSearch" class="form-control" type="text" placeholder="" onkeydown="if (event.keyCode == 13) document.getElementById('btnDataverseSearch').click();">
                    <span class="input-group-btn">
                        <button id="btnDataverseSearch" class="btn btn-default" type="button"
                            onclick="window.location = '/dataverse/root?q=' + document.getElementById('inputDataverseSearch').value;return false;"><span
                                class="glyphicon glyphicon-search"></span> Szukaj</button>
                    </span>
                </div>
            </div> -->
    </div>
</div>
<!-- PROJECT DESCRIPTION -->
<!-- <span class="glyphicon glyphicon-chevron-right"></span> CSS ARROW -->
<div class="row owners">
    <div class="col-xs-12">
        <div class="row">
            <div class="col-lg-4 col-xs-12">
                <p class="text-muted">
                    <a href="https://ibs.bialowieza.pl" class="flex-center" target="_blank"><img src="/logos/navbar/sm-ibs.jpg" alt="IBS PAN" /></a>
                </p>
            </div>
            <div class="col-lg-4 col-xs-12">
                <p class="text-muted">
                    <a href="http://www.biaman.pl" class="flex-center" target="_blank"><img src="/logos/navbar/sm-biaman.jpg" alt="MSK BIAMAN" /></a>
                </p>
            </div>
            <div class="col-lg-4 col-xs-12">
                <p class="text-muted">
                    <a href="https://zwl.pb.edu.pl" class="flex-center" target="_blank"><img src="/logos/navbar/sm-zwl.png" alt="ZWL PB" /></a>
                </p>
            </div>
        </div>
    </div>
</div>



<!-- ACTIONS -->
<div class="row hmpg-action-block">
    <div class="col-sm-6 col-xs-12 flex-column-center">
        <div class="h3 lite-header"><img class="data-icons" src="/logos/navbar/server-icon.svg" />Dodawanie i współdzielenie danych</div>
        <!-- <div class="h4 lite-header">Dodawanie i współdzielenie danych</div> -->
        <!-- <p class="text-muted margin-bottom">Podlaskie cyfrowe repozytorium przyrodniczych danych naukowych</p> -->

        <p class="margin-bottom-half">
            <!-- <span id="headAllTimeAllDatasetsValue" class="h4 lite-header"></span> <span class="text-muted">zbiorów -->
            <span id="headAllTimeAllDatasetsValue" class="h4 lite-header"></span> <span class="text-muted">zbiorów
                danych</span> &nbsp;&nbsp;
            <!-- <span id="headAllTimeAllDownloadsValue" class="h4 lite-header"></span> <span class="text-muted">łącznych
                pobrań</span> -->
            <span id="headAllTimeAllDownloadsValue" class="h4 lite-header"></span> <span class="text-muted">łącznych
            pobrań</span>
        </p>

        <a class="btn btn-default btn-harvard margin-top margin-bottom main-button" href="/dataset.xhtml?ownerId=1">
            Dodaj dane <img class="plus-icon" src="/logos/navbar/plus.svg">
        </a>
    </div>
    <div class="col-sm-6 col-xs-12 flex-column-center">
        <div class="h3 lite-header"><img class="data-icons" src="/logos/navbar/data-icon.svg" />Organizacja danych w repozytorium
        </div>
        <!-- <p class="text-muted margin-bottom">Kontener dla zbiorów danych, plików i metadanych</p> -->

        <p class="margin-bottom-half">
            <span id="headAllTimeAllDataversesValue" class="h4 lite-header"></span> <span class="text-muted">katalogów</span>
            <!-- <span id="headAllTimeAllDataversesValue" class="h4 lite-header"></span> <span class="text-muted">katalogów</span> -->
        </p>

        <a class="btn btn-default btn-harvard margin-top margin-bottom main-button" href="/dataverse.xhtml?ownerId=1">
            Dodaj katalog <img class="plus-icon" src="/logos/navbar/plus.svg">
        </a>
    </div>
</div>

<!-- SEARCH + BROWSE + RECENT -->
<div class="row hmpg-browse-block">

    <!-- SEARCH -->
    <!-- 
        NOTE: The alias of the root dataverse will need to be configured in this URL 
        -->
    <!-- <div class="col-xs-12">
        <div class="h4 lite-header margin-bottom">Szukaj po informacjach zawartych w kontenerach, plikach jak i metadanych</div>
        <div class="row">
            <div class="col-md-5 col-sm-6 col-xs-11">
                <div class="search-widget input-group">
                    <input id="inputDataverseSearch" class="form-control" type="text" placeholder="" onkeydown="if (event.keyCode == 13) document.getElementById('btnDataverseSearch').click();">
                    <span class="input-group-btn">
                            <button id="btnDataverseSearch" class="btn btn-default" type="button" onclick="window.location = '/dataverse/root?q=' + document.getElementById('inputDataverseSearch').value;return false;"><span class="glyphicon glyphicon-search"></span>                    Szukaj</button>
                    </span>
                </div>
            </div>
        </div>
    </div> -->

    <!-- BROWSE SUBJECT -->
    <div id="browseBySubject" class="container">
        <h3><img class="data-icons" src="/logos/navbar/search.svg" />Szukaj danych po temacie</h3>
        <!-- <p class="text-muted margin-bottom">Szukaj po temacie</p> -->
        <div class="row margin-bottom">
            <!-- SUBJECTS -->
            <div id="dataversesBySubject" class="col-xs-6">
            </div>


            <!-- VIEW ALL -->
            <!-- 
                NOTE: The alias of the root dataverse will need to be configured in this URL 
                -->
            <div class="col-xs-12 margin-top flex-column-center">
                <!-- <p class="browse-subjects small text-muted"><a href="/dataverse/root">Przejdź do wszystkich danych</a>
                    <span class="glyphicon glyphicon-chevron-right"></span>
                </p> -->
                <a class="btn btn-default btn-harvard margin-top margin-bottom main-button all-datasets-button" href="/dataverse/root">
                    Wszystkie dane <img class="plus-icon" src="/logos/navbar/plus-green.svg">
                </a>
            </div>
        </div>
    </div>

    <!-- <div id="recentActivity" class="col-xs-12">
        <div class="row">
            <div class="col-lg-4 col-xs-12 hmpg-recent-col">
                <div class="h4 lite-header margin-bottom">Ostatnie zbiory danych z dziennika aktywności</div>

                <hr class="col-xs-11 no-margin-top" />

                <div id="journals" class="row col-xs-12">
                    <p class="text-muted">Wczytywanie...</p>
                </div>

                <div class="row col-xs-12 hidden-lg">
                    <p class="small text-muted"><a href="/dataverse/root?q=%28categoryOfDataverse%3A%22Journal%22+OR+dvCategory%3A%22Journal%22%29&types=datasets%3Adataverses&sort=dateSort">WSZYSTKIE
                            OSTATNIE ZDARZENIA</a> <span class="glyphicon glyphicon-chevron-right"></span></p>
                </div>
            </div>

            <hr class="col-xs-12 hidden-lg spacer-rule" />

            <div class="col-lg-8 col-xs-12 hmpg-recent-col">
                <div class="h4 lite-header margin-bottom">Zbiory danych z innych kontenerów</div>

                <hr class="col-xs-11 no-margin-top" />

                <div id="researchers" class="row col-xs-12">
                    <p class="placeholder text-muted">Wczytywanie...</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4 col-xs-12 hmpg-recent-col">
                <div class="row col-xs-12 hidden-md hidden-sm hidden-xs margin-top">
                    <p class="small text-muted"><a href="/dataverse/root?q=%28categoryOfDataverse%3A%22Journal%22+OR+dvCategory%3A%22Journal%22%29&types=datasets%3Adataverses&sort=dateSort">WSZYSTKIE
                            OSTATNIE ZDARZENIA</a> <span class="glyphicon glyphicon-chevron-right"></span></p>
                </div>
            </div>
            <div class="col-lg-8 col-xs-12 hmpg-recent-col">
                <div class="row col-xs-12 margin-top">
                    <p class="small text-muted"><a href="/dataverse/root">WSZYSTKIE OSTATNIE ZDARZENIA</a> <span class="glyphicon glyphicon-chevron-right"></span></p>
                </div>
            </div>
        </div> 
    </div> -->
</div>

<!-- ACTIVITY -->
<!-- <div class="row hmpg-activity-block">
    <div class="col-xs-12">
        <div class="h4 lite-header margin-bottom">STATYSTYKI</div>
    </div>

    <div class="row">

        <div class="col-md-6 col-xs-12">
            <div class="col-xs-12 row">
                <div class="col-xs-4 highlightBold">Zbiory danych</div>
                <div class="col-xs-4 highlightBold">Cała aktywność</div>
                <div class="col-xs-4 highlightBold">Ostatnie 30 dni</div>
            </div>
            <div class="col-xs-12 row">
                <div class="col-xs-4 activity-label">Łącznie</div>
                <div class="col-xs-4 h4 lite-header" id="activityAllTimeAllDatasetsValue"><span class="text-muted">...</span></div>
                <div class="col-xs-4 h4 lite-header" id="activity30DaysAllDatasetsValue"><span class="text-muted">...</span></div>
            </div>
            <div class="col-xs-12 row">
                <div class="col-xs-4 activity-label">Składowane</div>
                <div class="col-xs-4 h4 lite-header" id="activityAllTimeDepositedDatasetsValue"><span class="text-muted">...</span></div>
                <div class="col-xs-4 h4 lite-header" id="activity30DaysDepositedDatasetsValue"><span class="text-muted">...</span></div>
            </div>
            <div class="col-xs-12 row">
                <div class="col-xs-4 activity-label">Zebrane</div>
                <div class="col-xs-4 h4 lite-header" id="activityAllTimeHarvestedDatasetsValue"><span class="text-muted">...</span></div>
                <div class="col-xs-4 h4 lite-header" id="activity30DaysHarvestedDatasetsValue"><span class="text-muted">...</span></div>
            </div>
        </div>

        <hr class="col-sm-12 hidden-md hidden-lg activity-rule" />

        <div class="col-md-6 col-xs-12">
            <div class="col-xs-12 row">
                <div class="col-xs-4 highlightBold">Pliki</div>
                <div class="col-xs-4 highlightBold">Cała aktywność</div>
                <div class="col-xs-4 highlightBold">Ostatnie 30 dni</div>
            </div>
            <div class="col-xs-12 row">
                <div class="col-xs-4 activity-label">Pobrane</div>
                <div class="col-xs-4 h4 lite-header" id="activityAllTimeAllDownloadsValue"><span class="text-muted">...</span></div>
                <div class="col-xs-4 h4 lite-header" id="activity30DaysAllDownloadsValue"><span class="text-muted">...</span></div>
            </div>
            <div class="col-xs-12 row">
                <div class="col-xs-4 activity-label">Składowane</div>
                <div class="col-xs-4 h4 lite-header" id="activityAllTimeDepositedFilesValue"><span class="text-muted">...</span></div>
                <div class="col-xs-4 h4 lite-header" id="activity30DaysDepositedFilesValue"><span class="text-muted">...</span></div>
            </div>
        </div>

    </div>
</div> -->

<script type="text/javascript">
    //<![CDATA[

    //switch baseUrl to point to a different server than the local box
    var baseUrl = "";

    // NOTE: REMOVED THUMBNAILS
    // var thumbBaseURL = baseUrl + "/api/datasets/:persistentId/thumbnail" + "?persistentId=";
    var metricBaseUrl = baseUrl + "/api/info/metrics/";
    var simpleCatSearch = baseUrl + "/api/search?q=*&type=dataset&sort=dateSort&order=desc&fq=categoryOfDataverse:";

    function writeRecentDatasetsInDataverses(fqString, resultCount, elm) {
        $.get(simpleCatSearch + fqString + "&per_page=" + resultCount, function(jData) {
            var resultHtml = "";
            jData.data.items.forEach(function(item) {
                var options = {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                };
                var date = new Date(item.published_at).toLocaleString('en-US', options);
                resultHtml += "<div class=\"hmpg-recent-block clearfix\">";
                // NOTE: REMOVED THUMBNAILS
                // resultHtml += "<div class=\"col-xs-2 text-center hmpg-recent-thumb\"><a href=\"/dataset.xhtml?persistentId=" + item.global_id + "\">";
                // resultHtml += "<object data=\"" + thumbBaseURL + item.global_id + "\" type=\"image/png\"/><span class=\"icon-dataset\"></span></object>";
                // resultHtml += "</a></div>";
                // NOTE: REMOVED THUMBNAILS... in next line, change grid layout class to `col-xs-9 col-md-10`
                resultHtml += "<div class=\"col-xs-12 hmpg-recent-metadata\"><p><a href=\"/dataset.xhtml?persistentId=" + item.global_id + "\">" + item.name + "</a></p><p class=\"small text-muted\"><a href=\"/dataverse/" + item.identifier_of_dataverse + "\" class=\"highlightBold\">" + item.name_of_dataverse + "</a> " + date + "</p></div>";
                resultHtml += "</div>";
            });
            // document.getElementById(elm).innerHTML = resultHtml;
        });
    }

    //For metrics that return simple json with a count
    //Can take a single element or an array of elements
    function queryMetricSimple(metricRelPath, month, elm) {
        $.get(metricBaseUrl + metricRelPath + month, function(jData) {
            var resultCount = jData.data.count;
            if (Array.isArray(elm)) {
                elm.forEach(function(e) {
                    // document.getElementById(e).innerHTML = resultCount.toLocaleString('en');
                });
            } else {
                // document.getElementById(elm).innerHTML = resultCount.toLocaleString('en');
            }
        });
    }

    function queryMetricSearch(metricRelPath, month) {
        $.get(metricBaseUrl + metricRelPath + month, function(jData) {
            var resultCount = jData.data.count;
            var roundedDatasetCount = Math.floor(resultCount / 100) * 100;
            var dynamicSearchPlaceholder = "Szukaj pośród " + roundedDatasetCount.toLocaleString('en') + " zbiorów danych...";
            $("#inputDataverseSearch").attr({
                "placeholder": dynamicSearchPlaceholder
            });
        });
    }


    /* Its working properly*/
    function querySubjectDataverseDataset(elm) {
        var dvArray = [];
        var fullArray = [];
        $.get(metricBaseUrl + "dataverses/bySubject", function(jData) {
            jData.data.forEach(function(item) {
                if (item.subject !== "N/A" && item.subject !== "Other") {
                    dvArray.push([item.subject, item.count]);
                }
            });
            $.get(metricBaseUrl + "datasets/bySubject?dataLocation=all", function(jData) {
                var resultHtml = "";
                jData.data.forEach(function(item) {
                    if (item.subject !== "N/A" && item.subject !== "Other") {
                        var dvCount = 0;
                        for (var dvi = 0; dvi < dvArray.length; dvi++) {
                            if (item.subject === dvArray[dvi][0]) {
                                dvCount = dvArray[dvi][1];
                                break;
                            }
                        }
                        fullArray.push([item.subject, (item.count + dvCount - 1).toLocaleString('en')]); //subtract 1 to remove root dv from counts
                    }
                });
                fullArray.sort();
                fullArray.forEach(function(subject) {
                    // NOTE: The alias of the root dataverse will need to be configured in this URL 
                    resultHtml += "<p class=\"browse-subjects\"><a href=\"/dataverse/root?q=&fq0=subject_ss%3A%22" + subject[0] + "%22&types=dataverses%3Adatasets&sort=dateSort&order=desc\">" + subject[0] + "</a> <span class=\"text-muted\">" + "(" + subject[1] + ")" + "</span></p>";
                });
                document.getElementById(elm).innerHTML = resultHtml;
            });
        });
    }

    queryMetricSimple("datasets", "?dataLocation=all", ["headAllTimeAllDatasetsValue", "activityAllTimeAllDatasetsValue"]);
    queryMetricSimple("downloads", "", ["headAllTimeAllDownloadsValue", "activityAllTimeAllDownloadsValue"]);
    queryMetricSimple("dataverses", "", "headAllTimeAllDataversesValue");

    writeRecentDatasetsInDataverses("(Journal)", 3, "journals");
    writeRecentDatasetsInDataverses("(\"Research+Project\"%20OR%20Researcher%20OR%20\"Research+Group\")", 6, "researchers");

    queryMetricSimple("datasets/pastDays", "/30?dataLocation=all", "activity30DaysAllDatasetsValue");
    queryMetricSimple("datasets", "?dataLocation=local", "activityAllTimeDepositedDatasetsValue");
    queryMetricSimple("datasets/pastDays", "/30?dataLocation=local", "activity30DaysDepositedDatasetsValue");
    queryMetricSimple("datasets", "?dataLocation=remote", "activityAllTimeHarvestedDatasetsValue");
    queryMetricSimple("datasets/pastDays", "/30?dataLocation=remote", "activity30DaysHarvestedDatasetsValue");

    queryMetricSimple("downloads/pastDays", "/30", "activity30DaysAllDownloadsValue");
    queryMetricSimple("files", "", "activityAllTimeDepositedFilesValue");
    queryMetricSimple("files/pastDays", "/30", "activity30DaysDepositedFilesValue");

    querySubjectDataverseDataset("dataversesBySubject");
    // queryMetricSearch("datasets", "?dataLocation=all");
    //]]>
</script>